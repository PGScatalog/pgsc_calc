{
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "$id": "https://raw.githubusercontent.com/pgscatalog/pgsc_calc/main/assets/schema_input.json",
  "title": "pgscatalog/pgsc_calc pipeline - params.input schema",
  "description": "Schema for the file provided with params.input",
  "type": "array",
  "uniqueItems": true,
  "items": {
    "type": "object",
    "properties": {
      "sampleset": {
        "type": "string",
        "pattern": "^\\S+$",
        "errorMessage": "sampleset must be a non-empty string without spaces",
        "meta": ["sampleset"]
      },
      "chrom": {
        "type": ["string", "integer", "null"],
        "pattern": "^(?:[1-9]|1[0-9]|2[0-2]|X|Y|MT)$",
        "errorMessage": "chrom must be a human autosome in range 1 - 22, X, Y, or MT",
        "meta": ["chrom"]
      },
      "path": {
        "type": "string",
        "format": "file-path",
        "exists": true,
        "pattern": "^([\\S\\s]*\\/)?[^\\s\\/]+\\.(bgen|vcf\\.gz)$",
        "errorMessage": "Target genotype file must be provided, cannot contain spaces, and must end with '.bgen' or '.vcf.gz'"
      },
      "file_format": {
        "type": "string",
        "enum": ["vcf", "bgen"],
        "errorMessage": "file_format must be either 'vcf' or 'bgen'",
        "meta": ["file_format"]
      },
      "genotyping_method": {
        "type": "string",
        "enum": ["array", "wgs"],
        "errorMessage": "genotyping_method must be either 'array' or 'wgs'",
        "meta": ["genotyping_method"]
      },
      "bgen_sample_file": {
        "type": "string",
        "format": "file-path",
        "exists": true,
        "pattern": "^([\\S\\s]*\\/)?[^\\s\\/]+\\.sample$",
        "errorMessage": "bgen_sample_file must point to a .sample file",
      }
    },
    "required": ["sampleset", "path", "file_format", "genotyping_method"],
    "additionalProperties": false,
    "allOf": [
      {
        "if": {
          "properties": { "file_format": { "const": "bgen" } }
        },
        "then": {
          "required": ["bgen_sample_file"]
        },
        "else": {
          "not": {
            "required": ["bgen_sample_file"]
          }
        }
      }
    ]
  }
}