nextflow_process {
    name "Test process pgsc_calc report"
    script "../main.nf"
    process "PGSC_CALC_REPORT"
    tag "module"

    test("my test"){
        setup {
            run("PGSC_CALC_FORMAT") {
                script "../../format/main.nf"
                process {
                    """
                    input[0] = Channel.fromPath("$baseDir/tests/data/PGS000586_hmPOS_GRCh38.txt.gz")
                    input[1] = Channel.fromPath("CHAIN_NO_FILE")
                    input[2] = Channel.of("GRCh38")
                    """
                }
            }
        }

        when {
            process {
                """
                input[0] = Channel.of("1000G")
                input[1] = Channel.fromPath("$baseDir/assets/example_results/scores.txt.gz")
                input[2] = PGSC_CALC_FORMAT.out.log_scorefiles
                input[3] = Channel.fromPath("$baseDir/assets/example_results/summary.csv")
                input[4] = Channel.of([false, false, 0.75])
                input[5] = Channel.fromPath("$baseDir/assets/report/*").collect()
                """
            }
        }


        then {
            assertAll(
                { assert process.success },
            )
        }
    }

    test("Test stub") {

    options "-stub"

        when {
            process {
                """
                input[0] = Channel.of("test")
                input[1] = Channel.fromPath("scores.txt.gz")
                input[2] = Channel.fromPath("score_log.json")
                input[3] = Channel.fromPath("match_summary.csv")
                input[4] = Channel.of([false, false, 0.75])
                input[5] = Channel.fromPath("$baseDir/assets/report/*").collect()
                """
            }
        }

        then {
            assertAll(
                { assert process.success },
                { assert snapshot(process.out.versions).match("versions") }
            )
        }
    }
}